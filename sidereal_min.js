"use strict";var date1,date2,place1,place2,long1,long2,lat1,lat2,tz1,tz2,tipsEnabled,tips,highPrecCalInTips,rotate1=0,rotate2=0,starsLoc=[],brightestStarsLoc=[],conLabelLoc=[];starsLoc[0]=brightStars(),starsLoc[1]=brightStars(),brightestStarsLoc[0]=brightestStars(),brightestStarsLoc[1]=brightestStars(),conLabelLoc[0]=constellationLabel(),conLabelLoc[1]=constellationLabel();var magLimit=5.3,magLimitTip=5.3,milkyLoc=[];function init(){init_cont()}function init_cont(){var t=new Date,e=$("#long1").text(),a=$("#lat1").text();""!=e&&""!=a?(place1=$("#place1").text(),long1=parseFloat(e),lat1=parseFloat(a)):(place1="Champaign, IL, USA",long1=-88.2434,lat1=40.1164);var r="GMT",o=t.getTimezoneOffset(),n=t.toTimeString(),i=n.indexOf("GMT");-1!=i&&(r=n.slice(i+3)),place2="",long2=long1,lat2=-30,lat1<0&&(lat2=30),tz2={tz:(tz1={tz:o,tzString:r}).tz,tzString:tz1.tzString};var d=t.getFullYear(),s=t.getMonth()+1,l=t.getDate(),c=t.getHours(),p=t.getMinutes(),h=t.getSeconds()+.001*t.getMilliseconds(),g=generateDateString(d,s,l),u=generateTimeString(c,p,h),m=getDm(d,s,l,tz1.tz)+(c+p/60+h/3600)/24,v=m/36525,y=DeltaT(v),M=getGMST(date1={yyyy:d,mm:s,dd:l,h:c,m:p,s:h,tz:tz1.tz,tzString:tz1.tzString,dateString:g,timeString:u,D:m,T:v,dT:y}),f=getSidereal(M,long1);date1.LST=f.hour,date1.LST_rad=f.rad,date1.LSTstring=f.string;var S=(c+=(tz1.tz-tz2.tz)/60)+p/60+h/3600;S-=24*Math.floor(c/24);var T=CalDat(m+tz2.tz/1440);h=3600*(S-(c=Math.floor(S))-(p=Math.floor(60*(S-c)))/60),u=generateTimeString(c,p,h),f=getSidereal(M=getGMST(date2={yyyy:T.yy,mm:T.mm,dd:T.dd,h:c,m:p,s:h,tz:tz2.tz,tzString:tz2.tzString,dateString:T.dateString,timeString:u,D:m,T:v,dT:y}),long2),date2.LST=f.hour,date2.LST_rad=f.rad,date2.LSTstring=f.string,tipsEnabled=!0,tips=[[],[]],highPrecCalInTips=!0,$("#loc1").on("click",function(t){displayPopup(t,1)}),$("#loc2").on("click",function(t){displayPopup(t,2)}),$("#rotate1").val(180*rotate1/Math.PI),$("#rotate2").val(180*rotate1/Math.PI),starChart()}function displayChangeLocs(){$("button.menu").attr("disabled",!0),$("#inputlocs").slideDown(),$("#geolocmessage").empty(),$("#geolocerr").empty(),$("#place1in").val(place1),$("#long1in").val(long1),$("#lat1in").val(lat1),$("#year1in").val(date1.yyyy),$("#month1in").val(date1.mm),$("#day1in").val(date1.dd),$("#hour1in").val(date1.h),$("#minute1in").val(date1.m),$("#second1in").val(date1.s.toFixed(3)),$("#tz1in").val(-tz1.tz/60),$("#place2in").val(place2),$("#long2in").val(long2),$("#lat2in").val(lat2),$("#year2in").val(date2.yyyy),$("#month2in").val(date2.mm),$("#day2in").val(date2.dd),$("#hour2in").val(date2.h),$("#minute2in").val(date2.m),$("#second2in").val(date2.s.toFixed(3)),$("#tz2in").val(-tz2.tz/60),$("#synTimeYes").prop("checked",!0),$("#synTimeNo").prop("checked",!1),$(".timeInputLoc2").hide()}function geoloc(){$("#geolocmessage").append("Please wait..."),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){var e=t.coords.longitude,a=t.coords.latitude;$("#place1in").val(""),$("#long1in").val(e),$("#lat1in").val(a),$("#geolocmessage").empty();$("#geolocmessage").append("Success! Longitude and latitude have been entered.")},function(t){ipLookUp()}):ipLookUp()}function ipLookUp(){$.ajax({url:"http://ip-api.com/json",success:function(t){var e=t.city;""!=t.region&&(e+=", "+t.region),e+=", "+t.countryCode,$("#place1in").text(e),$("#long1in").text(t.lon),$("#lat1in").text(t.lat),$("#geolocmessage").empty();$("#geolocmessage").append("Success! Longitude and latitude have been entered.")},timeout:1e3,error:function(t,e,a){$("#geolocmessage").empty();$("#geolocerr").append("Unable to determine your location by GPS or IP address!")}})}function changeSyncTime(t,e){var a="#"+e+"Yes",r="#"+e+"No";0==t?($(a).prop("checked",!1),$(r).prop("checked",!0),$(".timeInputLoc2").show()):($(a).prop("checked",!0),$(r).prop("checked",!1),$(".timeInputLoc2").hide())}function changeLocationsAndTimes(t){place1=t.place1in.value,long1=parseFloat(t.long1in.value),lat1=parseFloat(t.lat1in.value);var e=parseFloat(t.tz1in.value);tz1.tz=60*-e;var a=Math.abs(e)+.5/60;tz1.tzString=e>=0?"+":"-";var r=Math.floor(a).toString();r.length<2&&(r="0"+r);var o=Math.floor(60*(a-Math.floor(a))).toString();o.length<2&&(o="0"+o),tz1.tzString+=r+o;var n=parseInt(t.year1in.value),i=parseInt(t.month1in.value),d=parseInt(t.day1in.value),s=parseInt(t.hour1in.value),l=parseInt(t.minute1in.value),c=parseFloat(t.second1in.value);place2=t.place2in.value,long2=parseFloat(t.long2in.value),lat2=parseFloat(t.lat2in.value);var p=parseFloat(t.tz2in.value);tz2.tz=60*-p,a=Math.abs(p)+.5/60,tz2.tzString=p>=0?"+":"-",(r=Math.floor(a).toString()).length<2&&(r="0"+r),(o=Math.floor(60*(a-Math.floor(a))).toString()).length<2&&(o="0"+o),tz2.tzString+=r+o;var h,g,u,m,v,y,M=document.getElementById("synTimeYes").checked;M?(h=n,g=i,u=d,m=s,v=l,y=c):(h=parseInt(t.year2in.value),g=parseInt(t.month2in.value),u=parseInt(t.day2in.value),m=parseInt(t.hour2in.value),v=parseInt(t.minute2in.value),y=parseFloat(t.second2in.value));var f="#errorlocs";$(f).empty();var S=-180,T=180,b="Invalid longitude! Longitude must be a number between -180 and 180. West of Greenwich is negative; east of Greenwich is positive.";if(sanityCheck(long1,"#long1in",S,T,b,f),sanityCheck(long2,"#long2in",S,T,b,f),S=-90,T=90,b="Invalid latitude! Latitude must be a number between -90 and 90, positive in the northern hemisphere and negative in the southern hemisphere.",sanityCheck(lat1,"#lat1in",S,T,b,f),sanityCheck(lat2,"#lat2in",S,T,b,f),b="Invalid year! Please enter an integer between "+(S=-2e5)+" and "+(T=2e5)+". Note that 0 means 1 BCE, -1 means 2 BCE and so on. Warning: positions of the Sun, Moon and planets are not accurate outside the years between -3000 and 3000.",sanityCheck(n,"#year1in",S,T,b,f),M||sanityCheck(h,"#year2in",S,T,b,f),S=1,T=12,b="Invalid month! Month must be an integer between 1 and 12.",sanityCheck(i,"#month1in",S,T,b,f),M||sanityCheck(g,"#month2in",S,T,b,f),S=1,T=31,b="Invalid day! Day must be an integer between 1 and 31.",sanityCheck(d,"#day1in",S,T,b,f),M||sanityCheck(u,"#day2in",S,T,b,f),S=0,T=23,b="Invalid hour! Hour must be an integer between 0 and 23.",sanityCheck(s,"#hour1in",S,T,b,f),M||sanityCheck(m,"#hour2in",S,T,b,f),S=0,T=59,b="Invalid minute! Minute must be an integer between 0 and 59.",sanityCheck(l,"#minute1in",S,T,b,f),M||sanityCheck(v,"#minute2in",S,T,b,f),S=0,T=60,b="Invalid second! Second must be a number between 0 and 60.",sanityCheck(c,"#second1in",S,T,b,f),M||sanityCheck(y,"#second2in",S,T,b,f),S=-12,T=14,b="Invalid time zone! Time zone must be a number between -12 and 14.",sanityCheck(e,"#tz1in",S,T,b,f),sanityCheck(p,"#tz2in",S,T,b,f),""==$(f).text()){$("#inputlocs").slideUp(),$("button.menu").attr("disabled",!1);var x=getDm(n,i,d,0),L=CalDat(x);n=L.yy,i=L.mm,d=L.dd;var P=L.dateString,z=generateTimeString(s,l,c),A=(x=getDm(n,i,d,tz1.tz)+(s+l/60+c/3600)/24)/36525,C=DeltaT(A),_=getGMST(date1={yyyy:n,mm:i,dd:d,h:s,m:l,s:c,tz:tz1.tz,tzString:tz1.tzString,dateString:P,timeString:z,D:x,T:A,dT:C}),w=getSidereal(_,long1);date1.LST=w.hour,date1.LST_rad=w.rad,date1.LSTstring=w.string,x=getDm(h,g,u,0),h=(L=CalDat(x)).yy,g=L.mm,u=L.dd,P=L.dateString,z=generateTimeString(m,v,y),A=(x=getDm(h,g,u,tz2.tz)+(m+v/60+y/3600)/24)/36525,C=DeltaT(A),w=getSidereal(_=getGMST(date2={yyyy:h,mm:g,dd:u,h:m,m:v,s:y,tz:tz2.tz,tzString:tz1.tzString,dateString:P,timeString:z,D:x,T:A,dT:C}),long2),date2.LST=w.hour,date2.LST_rad=w.rad,date2.LSTstring=w.string,starChart()}}function showHide(t,e){var a=t.toString();$("#show"+e+a).toggleClass("active"),starChartLoc(t)}function rotInput(t){var e=t.toString(),a="#rotate"+e,r="#errRotate"+e;$(r).empty();var o=parseInt($(a).val());if($(a).css("background-color","transparent"),isNaN(o)){$(a).css("background-color","#e2a8a8");$(r).append('<p style="color:red;">Invalid input! Please enter an integer.</p>')}""==$(r).text()&&(o-=360*Math.floor(o/360),$(a).val(o),1==t?rotate1=o*Math.PI/180:rotate2=o*Math.PI/180,starChartLoc(t))}function getGMST(t){var e=Math.floor(t.D-.5)+.5,a=t.h+t.m/60+t.s/3600+t.tz/60;a-=24*Math.floor(a/24);var r=.06570748587250752*e;r-=24*Math.floor(r/24),r+=6.697374558336001+1.0027378119113546*a,r-=24*Math.floor(r/24);var o=t.T+t.dT;return r+=2.686296296296296e-7+o*(.08541030618518518+2577003148148148e-20*o),r-=24*Math.floor(r/24)}function getSidereal(t,e){var a=t+e/15,r=(a-=24*Math.floor(a/24))*Math.PI/12,o=a+.5/3600,n=Math.floor(o).toString(),i=Math.floor(60*(o-n)).toString(),d=Math.floor(3600*(o-n-i/60)).toString();return n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),d.length<2&&(d="0"+d),{hour:a,rad:r,string:n+":"+i+":"+d}}function starChart(){var t=date1.dateString+"&nbsp;&nbsp;"+date1.timeString+"  GMT"+tz1.tzString,e=date2.dateString+"&nbsp;&nbsp;"+date2.timeString+" GMT"+tz2.tzString;$("#place1").text(place1),$("#long1").html(long1+"&deg;"),$("#lat1").html(lat1+"&deg;"),$("#time1").html(t),$("#siderealTime1").text(date1.LSTstring),$("#place2").text(place2),$("#long2").html(long2+"&deg;"),$("#lat2").html(lat2+"&deg;"),$("#time2").html(e),$("#siderealTime2").text(date2.LSTstring);var a=setupDrawingParameters();starChartLoc(1),starChartLoc(2),addLegend(a)}function starChartLoc(t){var e,a,r;1==t?(e=date1,a=lat1):(e=date2,a=lat2);var o=a*Math.PI/180,n=t.toString(),i=document.getElementById("loc"+n);Math.abs(e.yyyy)>3e3&&""==$("#warning"+n).text()&&$("#warning"+n).append('<p style="color:red;">Warning: Positions of the Sun, Moon and planets are not accurate at this time.</p>'),Math.abs(e.yyyy)<3e3&&""!=$("#warning"+n).text()&&$("#warning"+n).empty();e.T;var d=e.T+e.dT,s=setupDrawingParameters();s.loc=t,s.rotate=rotate1,2==t&&(s.rotate=rotate2),s.cosRotAng=Math.cos(s.rotate),s.sinRotAng=Math.sin(s.rotate);var l={milky:{}};if(s.showPlanets=$("#showPlanets"+n).hasClass("active"),s.showEquator=$("#showEquator"+n).hasClass("active"),s.showEcliptic=$("#showEcliptic"+n).hasClass("active"),s.showMilkyWay=$("#showMilkyWay"+n).hasClass("active"),s.showConLines=$("#showConLines"+n).hasClass("active"),s.showConLab=$("#showConLab"+n).hasClass("active"),s.showDayNight=$("#showDayNight"+n).hasClass("active"),s.showEcliptic&&(Math.abs(d)<1?s.eclipticNorthPoleDec=1.16170371649804:s.eclipticNorthPoleDec=.5*Math.PI-epsA(d)),s.showMilkyWay){l.milky.north=milkyLoc[t-1].northernEdge,l.milky.south=milkyLoc[t-1].southernEdge,l.milky.betaCas=milkyLoc[t-1].betaCas,l.milky.thetaOph=milkyLoc[t-1].thetaOph,l.milky.lambdaSco=milkyLoc[t-1].lambdaSco,l.milky.coalsack=milkyLoc[t-1].coalsack,r=l.milky.north[0].Tepoch,Math.abs(d-r)>.1&&milkyWayBoundaryPrecession(l.milky,r,d);var c=galacticNorthPole(d);s.galPoleRa=c.ra,s.galPoleDec=c.dec}if(l.conLines=constellationLines(),s.showConLab&&(l.conLab=conLabelLoc[t-1],r=l.conLab[0].Tepoch,Math.abs(d-r)>.1)){var p=precession_matrix(r,d-r);addPrecession(l.conLab,p,d);for(var h=1;h<l.conLab.length;h++)if("ra2"in l.conLab[h]){var g=precessed_ra_dec(l.conLab[h].ra2,l.conLab[h].dec2,p);l.conLab[h].ra2=g.ra,l.conLab[h].dec2=g.dec}}l.stars=starsLoc[t-1],r=l.stars[0].Tepoch,Math.abs(d-r)>.1&&recomputeStarPos(d,l.stars),s.showPlanets?l.planets=sunMoonPlanets(d):(l.planets=[],l.planets[0]=MiniSun(d)),drawStarsPlanets(i,l,s,e.LST_rad,o)}function drawStarsPlanets(t,e,a,r,o){var n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);var i=Math.cos(o),d=Math.sin(o),s=.5*Math.PI,l=2*Math.PI,c=.47*Math.max(t.width,t.height),p=.5*t.width,h=.5*t.height,g={ra:e.planets[0].ra,dec:e.planets[0].dec},u=180*ra_dec_to_alt_az(g,r,i,d).alt/Math.PI;n.beginPath(),n.setLineDash([]),n.arc(p,h,c,0,2*Math.PI);var m=255,v=255;a.showDayNight&&(m=Math.round(255*(1+u/18)),m=Math.min(m,255),m=Math.max(0,m),v=Math.round(.95*m)),n.fillStyle="rgb("+v+","+v+","+m+")",n.fill(),n.strokeStyle="black",n.stroke();var y,M,f,S,T,b,x={halfPI:s,xc:p,yc:h,r:c,r2:c*c,altSun:u,rotate:a.rotate,cosRotAng:a.cosRotAng,sinRotAng:a.sinRotAng};if(drawAzimuthLabels(n,x),a.showEquator){var L="black";m<170&&(L="yellow"),drawCircle(n,r,i,d,{ra:0,dec:s,linestyle:[],color:L},x)}if(a.showEcliptic){var P="brown";m<170&&(P="yellow"),drawCircle(n,r,i,d,{ra:-.5*Math.PI,dec:a.eclipticNorthPoleDec,linestyle:[10,15],color:P},x)}a.showMilkyWay&&(drawMilkyWay(n,r,e.milky,i,d,x,a),drawCircle(n,r,i,d,{ra:a.galPoleRa,dec:a.galPoleDec,linestyle:[14,15],color:"magenta"},x)),(a.showConLines||tipsEnabled)&&(tipsEnabled&&((y=new Array(e.stars.length)).fill(!0),tips[a.loc-1].length=0),drawConstellationLinesAndSetupTips(n,e.conLines,e.stars,r,i,d,x,a,y));var z=e.stars.length;for(n.fillStyle=m<170?"white":"black",M=1;M<z;M++)e.stars[M].mag>magLimit||(b=ra_dec_to_xy_above(e.stars[M],r,i,d,x)).x>-998&&(T=a.starMagA*e.stars[M].mag+a.starMagB,T=Math.max(T,1),n.beginPath(),n.arc(b.x,b.y,T,0,l),n.fill(),tipsEnabled&&e.stars[M].mag<magLimitTip&&y[M]&&(y[M]=!1,T=Math.max(T,3),tips[a.loc-1].push({x:b.x,y:b.y,r2:T*T,object:"star",starInd:M})));if(tipsEnabled&&(y.length=0),a.showPlanets)for(n.font="20px Arial",M=0;M<9;M++){if(g={ra:e.planets[M].ra,dec:e.planets[M].dec},1==M){var A=topoCentricEquatorial(e.planets[M].rGeo,g.ra,g.dec,r,d,i);g={ra:A.raTopo,dec:A.decTopo}}if((b=ra_dec_to_xy_above(g,r,i,d,x)).x>-998){f=b.x,S=b.y;var C=String.fromCharCode(a.code[M]);n.fillStyle=a.color[M],n.fillText(C,f+a.offset[M].x,S+a.offset[M].y),n.beginPath(),n.arc(f,S,a.size[M],0,l),n.fill(),tipsEnabled&&(T=.5*n.measureText(C).width,T=Math.max(T,10),tips[a.loc-1].push({x:f+a.offset[M].x+T,y:S+a.offset[M].y-10,r2:T*T,object:a.pName[M],pIndex:M}))}}a.showConLab&&drawConstellationLabel(n,e.conLab,r,i,d,x,a)}function drawAzimuthLabels(t,e){var a=10*Math.PI/180,r=180*e.rotate/Math.PI;t.font="15px Arial",t.txtAlign="center",t.fillStyle="black";for(var o=0;o<36;o++){var n=10*o-r;n-=360*Math.floor(n/360);var i,d,s=o*a-e.rotate,l=Math.cos(s),c=Math.sin(s),p=e.xc-e.r*c,h=e.yc-e.r*l,g=e.xc-1.02*e.r*c,u=e.yc-1.02*e.r*l;n<90||n>270?(i=e.xc-1.03*e.r*c,d=e.yc-1.03*e.r*l):(i=e.xc-1.06*e.r*c,d=e.yc-1.06*e.r*l),t.beginPath(),t.moveTo(p,h),t.lineTo(g,u),t.stroke();var m=10*o,v=m+String.fromCharCode(176);0==m?v="N":90==m?v="E":180==m?v="S":270==m&&(v="W"),t.save(),t.translate(i,d),n<90||n>270?t.rotate(-s):t.rotate(Math.PI-s);var y=t.measureText(v).width;t.fillText(v,.5*-y,0),t.restore()}t.txtAlign="start"}function ra_dec_to_alt_az(t,e,a,r){var o=e-t.ra,n=Math.cos(o),i=Math.sin(o),d=Math.cos(t.dec),s=Math.sin(t.dec),l=s*r+a*d*n;l=Math.asin(l);var c=Math.cos(l),p=d*i/c,h=(d*n*r-s*a)/c;return Math.abs(c)<1e-10&&(p=0,h=1),{alt:l,cosA:h,sinA:p}}function atmosphericRefraction(t,e,a){var r=t+.003137559423803098/(t+.08918632477691024);return.000296705972839036*(2.80198*e/a)/Math.tan(r)}function ra_dec_to_xy_above(t,e,a,r,o){var n=e-t.ra,i=Math.cos(n),d=Math.sin(n),s=Math.cos(t.dec),l=Math.sin(t.dec),c=l*r+a*s*i;c=Math.asin(c);var p,h,g=Math.cos(c),u=s*d/g,m=(s*i*r-l*a)/g,v=u*o.cosRotAng-m*o.sinRotAng,y=m*o.cosRotAng+u*o.sinRotAng;if(Math.abs(g)<1e-10&&(v=0,y=1),c>-.0175&&(c+=atmosphericRefraction(c,101,286)),c>=0){var M=o.r*Math.tan(.5*(o.halfPI-c));p=o.xc+M*v,h=o.yc+M*y}else p=-999,h=-999;return{x:p,y:h}}function ra_dec_to_xy(t,e,a,r,o){var n=e-t.ra,i=Math.cos(n),d=Math.sin(n),s=Math.cos(t.dec),l=Math.sin(t.dec),c=l*r+a*s*i;c=Math.asin(c);var p=Math.cos(c),h=s*d/p,g=(s*i*r-l*a)/p,u=h*o.cosRotAng-g*o.sinRotAng,m=g*o.cosRotAng+h*o.sinRotAng;Math.abs(p)<1e-10&&(u=0,m=1),c>-.0175&&(c+=atmosphericRefraction(c,101,286));var v=o.r*Math.tan(.5*(o.halfPI-c));return{x:o.xc+v*u,y:o.yc+v*m}}function topoCentricEquatorial(t,e,a,r,o,n){var i=t*Math.cos(e)*Math.cos(a),d=t*Math.sin(e)*Math.cos(a),s=t*Math.sin(a),l=6378.1366/Math.sqrt(n*n+.9933056020041341*o*o),c=.9933056020041341*l,p=i-l*n*Math.cos(r),h=d-l*n*Math.sin(r),g=s-c*o,u=Math.sqrt(p*p+h*h+g*g);return{rTopo:u,raTopo:Math.atan2(h,p),decTopo:Math.asin(g/u)}}function drawCircle(t,e,a,r,o,n){var i,d,s,l,c,p=!0;if(Math.abs(o.dec-n.halfPI)<1e-5)i=-a,d=0,s=r;else{var h,g=e-o.ra,u=Math.sin(g),m=Math.cos(g),v=Math.sin(o.dec),y=Math.cos(o.dec),M=r*v+a*y*m;Math.abs(Math.abs(M)-1)<1e-5?p=!1:(i=(h=Math.sqrt(1-M*M))*(c=(y*m*r-v*a)/h),d=h*(l=y*u/h),s=M)}if(p){var f=Math.sqrt(i*i+d*d),S=-d/f,T=i/f,b=-s*T,x=s*S,L=f,P=Math.PI/25;t.beginPath(),t.setLineDash(o.linestyle),c=S;var z=(l=T)*n.cosRotAng-c*n.sinRotAng,A=c*n.cosRotAng+l*n.sinRotAng,C=n.xc+n.r*z,_=n.yc+n.r*A;t.moveTo(C,_);for(var $=1;$<25;$++){var w=$*P,I=Math.cos(w),D=Math.sin(w),k=I*S+D*b,R=I*T+D*x,E=D*L,F=Math.sqrt(k*k+R*R);if(F<1e-5)t.lineTo(n.xc,n.yc);else{c=k/F,z=(l=R/F)*n.cosRotAng-c*n.sinRotAng,A=c*n.cosRotAng+l*n.sinRotAng;var G=Math.asin(E),N=n.r*Math.tan(.5*(n.halfPI-G));C=n.xc+N*z,_=n.yc+N*A;t.lineTo(C,_)}}c=-S,z=(l=-T)*n.cosRotAng-c*n.sinRotAng,A=c*n.cosRotAng+l*n.sinRotAng,C=n.xc+n.r*z,_=n.yc+n.r*A,t.lineTo(C,_),t.strokeStyle=o.color,t.stroke()}}function milkyWayBoundaryPrecession(t,e,a){var r=precession_matrix(e,a-e);addPrecession(t.north,r,a),addPrecession(t.south,r,a),addPrecession(t.betaCas,r),addPrecession(t.thetaOph,r,a),addPrecession(t.lambdaSco,r,a),addPrecession(t.coalsack,r,a)}function addPrecession(t,e,a){t[0].epoch="",t[0].Tepoch=a;for(var r=1;r<t.length;r++){var o=precessed_ra_dec(t[r].ra,t[r].dec,e);t[r].ra=o.ra,t[r].dec=o.dec}}function drawMilkyWay(t,e,a,r,o,n,i){i.showDayNight&&n.altSun<-6?t.strokeStyle="yellow":t.strokeStyle="blue",t.setLineDash([]),drawLineAboveHorizon(t,e,a.north,r,o,n),drawLineAboveHorizon(t,e,a.south,r,o,n),drawLineAboveHorizon(t,e,a.betaCas,r,o,n),drawLineAboveHorizon(t,e,a.thetaOph,r,o,n),drawLineAboveHorizon(t,e,a.lambdaSco,r,o,n),drawLineAboveHorizon(t,e,a.coalsack,r,o,n)}function drawLineAboveHorizon(t,e,a,r,o,n){var i,d,s={ra:a[1].ra,dec:a[1].dec},l=ra_dec_to_xy(s,e,r,o,n);i=l.x,d=l.y;for(var c=2;c<a.length;c++)addLine(t,i,d,i=(l=ra_dec_to_xy(s={ra:a[c].ra,dec:a[c].dec},e,r,o,n)).x,d=l.y,n)}function galacticNorthPole(t){var e=precession_matrix(0,t);return precessed_ra_dec(3.366012906575397,.4734787372451951,e)}function drawConstellationLinesAndSetupTips(t,e,a,r,o,n,i,d,s){var l,c,p,h;for(t.strokeStyle="#1B9722",d.showDayNight&&i.altSun<-6&&(t.strokeStyle="#93ff33"),t.setLineDash([]),c=0;c<e.length;c++)$.each(e[c],function(e,c){if("name"!=e&&"abbr"!=e){var g,u,m,v,y={ra:a[c[0]].ra,dec:a[c[0]].dec},M=ra_dec_to_xy(y,r,o,n,i);u=M.x,v=M.y,h=(u-i.xc)*(u-i.xc)+(v-i.yc)*(v-i.yc),tipsEnabled&&s[c[0]]&&h<i.r2&&(l=c[0],s[l]=!1,p=d.starMagA*a[l].mag+d.starMagB,p=Math.max(p,3),tips[d.loc-1].push({x:u,y:v,r2:p*p,object:"star",starInd:l}));for(var f=1;f<c.length;f++)g=u,m=v,u=(M=ra_dec_to_xy(y={ra:a[c[f]].ra,dec:a[c[f]].dec},r,o,n,i)).x,v=M.y,d.showConLines&&addLine(t,g,m,u,v,i),h=(u-i.xc)*(u-i.xc)+(v-i.yc)*(v-i.yc),tipsEnabled&&s[c[f]]&&h<i.r2&&(l=c[f],s[l]=!1,p=d.starMagA*a[l].mag+d.starMagB,p=Math.max(p,3),tips[d.loc-1].push({x:u,y:v,r2:p*p,object:"star",starInd:l}))}})}function drawConstellationLabel(t,e,a,r,o,n,i){t.font=12..toString()+"px Arial";var d=255,s=255;i.showDayNight&&(d=Math.round(255*(1+n.altSun/18)),d=Math.min(d,255),d=Math.max(0,d),s=Math.round(.95*d));var l="orange";d>130&&(l="#6c3483");for(var c="rgb("+s+","+s+","+d+")",p=1;p<e.length;p++){var h={ra:e[p].ra,dec:e[p].dec},g=ra_dec_to_xy_above(h,a,r,o,n);if(g.x>-998){var u=t.measureText(e[p].abbr).width;t.fillStyle=c,t.fillRect(g.x,g.y-12,u,12),t.fillStyle=l,t.fillText(e[p].abbr,g.x,g.y)}"ra2"in e[p]&&(g=ra_dec_to_xy_above(h={ra:e[p].ra2,dec:e[p].dec2},a,r,o,n)).x>-998&&(t.fillStyle=c,t.fillRect(g.x,g.y-12,u,12),t.fillStyle=l,t.fillText(e[p].abbr,g.x,g.y))}}function recomputeStarPos(t,e){var a=e[0].Tepoch,r=t-a;e[0].epoch="",e[0].Tepoch=t;for(var o=precession_matrix(a,r),n=1;n<e.length;n++){var i=e[n].x+e[n].vx*r,d=e[n].y+e[n].vy*r,s=e[n].z+e[n].vz*r,l=Math.sqrt(i*i+d*d+s*s);e[n].dist2000<99e3&&(e[n].mag=e[n].mag2000+5*Math.LOG10E*Math.log(l/e[n].dist2000)),e[n].x=o.p11*i+o.p12*d+o.p13*s,e[n].y=o.p21*i+o.p22*d+o.p23*s,e[n].z=o.p31*i+o.p32*d+o.p33*s;var c=e[n].vx,p=e[n].vy,h=e[n].vz;e[n].vx=o.p11*c+o.p12*p+o.p13*h,e[n].vy=o.p21*c+o.p22*p+o.p23*h,e[n].vz=o.p31*c+o.p32*p+o.p33*h,e[n].ra=Math.atan2(e[n].y,e[n].x),e[n].dec=Math.asin(e[n].z/l)}}function addLine(t,e,a,r,o,n){var i=function(t){return t*t},d=i(e-n.xc)+i(a-n.yc),s=i(r-n.xc)+i(o-n.yc);if(!(d>n.r2&&s>n.r2)){var l=e,c=r,p=a,h=o;if(d>n.r2||s>n.r2){var g,u=(e-n.xc)*(r-n.xc)+(a-n.yc)*(o-n.yc),m=i(e-r)+i(a-o),v=d-u;d<=n.r2?(c=e+(g=(v+Math.sqrt(v*v+m*(n.r2-d)))/m)*(r-e),h=a+g*(o-a)):(l=e+(g=(v-Math.sqrt(v*v+m*(n.r2-d)))/m)*(r-e),p=a+g*(o-a))}t.beginPath(),t.moveTo(l,p),t.lineTo(c,h),t.stroke()}}function addLegend(t){var e,a,r,o,n=document.getElementById("legend"),i=n.getContext("2d");i.clearRect(0,0,n.width,n.height),i.font="20px Arial",i.fillStyle="black",i.fillText("Magnitude scale:",0,20);var d=2*Math.PI;for(e=-1;e<6;e++){a=t.starMagA*e+t.starMagB,r=180+40*(e+1);var s=-20;-1==e&&(s=-22),i.fillText(e.toString(),r+s,20),i.beginPath(),i.arc(r,15,a,0,d),i.fill()}i.fillText("Planet symbols:   Sun",0,50),i.fillText("Moon",270,50),i.fillText("Mercury",380,50),i.fillText("Venus",160,75),i.fillText("Mars",270,75),i.fillText("Jupiter",380,75),i.fillText("Saturn",160,100),i.fillText("Uranus",270,100),i.fillText("Neptune",380,100),i.fillStyle=t.color[0],r=195,o=50,i.fillText(String.fromCharCode(t.code[0]),r,o),i.beginPath(),i.arc(r-t.offset[0].x,o-t.offset[0].y,t.size[0],0,d),i.fill(),i.fillStyle=t.color[1],r=320,i.fillText(String.fromCharCode(t.code[1]),r,o),i.beginPath(),i.arc(r-t.offset[1].x,o-t.offset[1].y,t.size[1],0,d),i.fill(),i.fillStyle=t.color[2],r=455,i.fillText(String.fromCharCode(t.code[2]),r,o),i.beginPath(),i.arc(r-t.offset[2].x,o-t.offset[2].y,t.size[2],0,d),i.fill(),i.fillStyle=t.color[3],r=220,o=75,i.fillText(String.fromCharCode(t.code[3]),r,o),i.beginPath(),i.arc(r-t.offset[3].x,o-t.offset[3].y,t.size[3],0,d),i.fill(),i.fillStyle=t.color[4],r=320,i.fillText(String.fromCharCode(t.code[4]),r,o),i.beginPath(),i.arc(r-t.offset[4].x,o-t.offset[4].y,t.size[4],0,d),i.fill(),i.fillStyle=t.color[5],r=445,i.fillText(String.fromCharCode(t.code[5]),r,o),i.beginPath(),i.arc(r-t.offset[5].x,o-t.offset[5].y,t.size[5],0,d),i.fill(),i.fillStyle=t.color[6],r=225,o=100,i.fillText(String.fromCharCode(t.code[6]),r,o),i.beginPath(),i.arc(r-t.offset[6].x,o-t.offset[6].y,t.size[6],0,d),i.fill(),i.fillStyle=t.color[7],r=335,i.fillText(String.fromCharCode(t.code[7]),r,o),i.beginPath(),i.arc(r-t.offset[7].x,o-t.offset[7].y,t.size[7],0,d),i.fill(),i.fillStyle=t.color[8],r=460,i.fillText(String.fromCharCode(t.code[8]),r,o),i.beginPath(),i.arc(r-t.offset[8].x,o-t.offset[8].y,t.size[8],0,d),i.fill()}function displayPopup(t,e){var a,r,o=document.getElementById("loc"+e).getBoundingClientRect(),n=t.clientX-o.left,i=t.clientY-o.top,d=!1;for(a=0;a<tips[e-1].length;a++){var s=n-(r=tips[e-1][a]).x,l=i-r.y;if(s*s+l*l<r.r2){d=!0;break}}if(d){var c,p,h="#tip"+e;$(h+"text").empty(),1==e?(c=date1,long1,p=lat1*Math.PI/180):(c=date2,long2,p=lat2*Math.PI/180);var g=c.h+c.m/60+c.s/3600,u=c.LST_rad-1.0027378119113546*g*Math.PI/12;u-=2*Math.PI*Math.floor(.5*u/Math.PI);var m={loc:e,lat:p,LST:c.LST_rad,LST0:u,T:c.T,dT:c.dT,hours:g},v=c.T+c.dT;v>-50&&v<10&&(m.nu=nutation(v),m.LAST=m.LST+m.nu.Ee),"star"==r.object?displayPopupStar(r,m):"Sun"==r.object?displayPopupSun(r,m):"Moon"==r.object?displayPopupMoon(r,m):displayPopupPlanet(r,m),$(h).css("left",r.x+3+"px"),$(h).css("top",r.y+3+"px"),$(h).show()}}function closePopup(t){var e="#"+t;$(e).hide(),$(e+"text").empty(),$(e).css("left","-200px")}function displayPopupSun(t,e){var a,r=[!1,!1,!0,!1,!1,!1,!1,!1],o=e.T+e.dT;a=highPrecCalInTips?planetGeoVSOP(o,"Sun",!1):planetPos(o,r)[2];var n,i,d=180/Math.PI,s=12/Math.PI,l=convertDM(a.ra2000*s,"hm"),c=convertDM(a.dec2000*d,"dm"),p=Math.cos(e.lat),h=Math.sin(e.lat),g=e.LST;"nu"in e?(g=e.LAST,n=precessed_ra_dec(a.ra,a.dec,e.nu),a.ra=n.ra,a.dec=n.dec,i=topoCentricEquatorial(149597870.7*a.rGeo,a.ra,a.dec,g,h,p)):i=topoCentricEquatorial(149597870.7*a.rGeo,a.ra,a.dec,g,h,p);var u={ra:i.raTopo,dec:i.decTopo};if("nu"in e){var m={T:o,m:e.nu,LAST:e.LAST,cosLat:p,sinLat:h};u=aberration(i.raTopo,i.decTopo,m)}var v=convertDM(u.ra*s,"hm"),y=convertDM(u.dec*d,"dm"),M=precession_matrix(o,-o);if("nu"in e){var f={p11:e.nu.p11,p12:e.nu.p21,p13:e.nu.p31,p21:e.nu.p12,p22:e.nu.p22,p23:e.nu.p32,p31:e.nu.p13,p32:e.nu.p23,p33:e.nu.p33};n=precessed_ra_dec(i.raTopo,i.decTopo,f),n=precessed_ra_dec(n.ra,n.dec,M)}else n=precessed_ra_dec(i.raTopo,i.decTopo,M);var S=constellationAbbrNames()[get_constellation(n.ra,n.dec)],T=convertDM(n.ra*s,"hm"),b=convertDM(n.dec*d,"dm"),x=31.965/a.rGeo,L=ra_dec_to_alt_az(n={ra:u.ra,dec:u.dec},g,p,h),P=(L.alt+atmosphericRefraction(L.alt,101,286))*d,z=Math.atan2(L.sinA,L.cosA)*d+180;P=P.toFixed(2)+"&deg;",z=z.toFixed(2)+"&deg;";for(var A=o-e.hours/876600,C=[],_=[],w=0;w<25;w++)a=planetPos(A+w/876600,r)[2],C[w]=a.ra,_[w]=a.dec;var I=getTransitTime(e.LST0,e.lat,C,_,!1),D=I.t+" ("+I.alt+")",k=-.01454441043328608,R=getRiseSet(k,e.LST0,e.lat,C,_),E=R.rise+" ("+R.azRise+"), "+R.set;"above"==R.rise&&(E="circumpolar"),k=-.1047197551196598;var F=(R=getRiseSet(k,e.LST0,e.lat,C,_)).rise+", "+R.set;"above"==R.rise&&(F="above -6&deg;"),k=-.2094395102393196;var G=(R=getRiseSet(k,e.LST0,e.lat,C,_)).rise+", "+R.set;"above"==R.rise&&(G="above -12&deg;"),k=-.3141592653589793;var N=(R=getRiseSet(k,e.LST0,e.lat,C,_)).rise+", "+R.set;"above"==R.rise&&(N="above -18&deg;");var q="<table>";q+='<tr><th colspan="2">Sun</th></tr>',q+="<tr><td>Distance</td> <td>"+a.rGeo.toFixed(3)+" AU</td></tr>",q+="<tr><td>Angular Diameter</td> <td>"+x.toFixed(1)+"'</td></tr>",q+="<tr><td>Geocentric Ra, Dec (J2000)</td> <td>"+l+", "+c+"</td></tr>",q+="<tr><td>Topocentric Ra, Dec (J2000)</td> <td>"+T+", "+b+"</td></tr>","nu"in e?(q+="<tr><td>App. Topo. Ra, Dec (of date)</td> <td>"+v+", "+y+"</td></tr>",q+="<tr><td>Apparent Sidereal Time</td> <td>"+convertDM(12*e.LAST/Math.PI,"hm")+"</td></tr>"):q+="<tr><td>Topocentric Ra, Dec (of date)</td> <td>"+v+", "+y+"</td></tr>",q+="<tr><td>Constellation</td><td>"+S+"</td></tr>",q+="<tr><td>Altitude, Azimuth</td> <td>"+P+", "+z+"</td></tr>",q+="<tr><td>Rise (Azi), Set</td> <td>"+E+"</td></tr>",q+="<tr><td>Upper Transit (Altitude)</td> <td>"+D+"</td></tr>",q+="<tr><td>Civ. Twi. beg., end</td> <td>"+F+"</td></tr>",q+="<tr><td>Nat. Twi. beg., end</td> <td>"+G+"</td></tr>",q+="<tr><td>Ast. Twi. beg., end</td> <td>"+N+"</td></tr>";var U="#tip"+e.loc+"text";$(U).append(q)}function displayPopupMoon(t,e){var a,r,o,n,i,d,s=e.T+e.dT;if(highPrecCalInTips){o=(a=MoonPosElpMpp02(s,!0)).rGeo;d=(r=planetPos(s,[!1,!1,!0,!1,!1,!1,!1,!1])[2]).rGeo,i=r.lam2000,n=a.lam2000}else a=MediumMoon(s),d=1,i=(r=MiniSun(s)).lam,n=a.lam,o=a.rGeo;var l,c,p=180/Math.PI,h=12/Math.PI,g=Math.cos(e.lat),u=Math.sin(e.lat),m=convertDM(a.ra2000*h,"hm"),v=convertDM(a.dec2000*p,"dm"),y=e.LST;"nu"in e?(y=e.LAST,l=precessed_ra_dec(a.ra,a.dec,e.nu),a.ra=l.ra,a.dec=l.dec,c=topoCentricEquatorial(a.rGeo,a.ra,a.dec,y,u,g)):c=topoCentricEquatorial(a.rGeo,a.ra,a.dec,e.LST,u,g);var M={ra:c.raTopo,dec:c.decTopo};if("nu"in e){var f=15514103102587391e-22*g/Math.sqrt(g*g+.9933056020041341*u*u),S=-f*Math.sin(e.LAST),T=f*Math.cos(e.LAST),b=Math.cos(M.ra)*Math.cos(M.dec)+S,x=Math.sin(M.ra)*Math.cos(M.dec)+T,L=Math.sin(M.dec),P=Math.sqrt(b*b+x*x+L*L);M.ra=Math.atan2(x,b),M.dec=Math.asin(L/P)}var z=convertDM(M.ra*h,"hm"),A=convertDM(M.dec*p,"dm"),C=c.rTopo,_=precession_matrix(s,-s);if("nu"in e){var w={p11:e.nu.p11,p12:e.nu.p21,p13:e.nu.p31,p21:e.nu.p12,p22:e.nu.p22,p23:e.nu.p32,p31:e.nu.p13,p32:e.nu.p23,p33:e.nu.p33};l=precessed_ra_dec(c.raTopo,c.decTopo,w),l=precessed_ra_dec(l.ra,l.dec,_)}else l=precessed_ra_dec(c.raTopo,c.decTopo,_);var I=constellationAbbrNames()[get_constellation(l.ra,l.dec)],D=convertDM(l.ra*h,"hm"),k=convertDM(l.dec*p,"dm"),R=ra_dec_to_alt_az(l={ra:M.ra,dec:M.dec},y,g,u),E=(R.alt+atmosphericRefraction(R.alt,101,286))*p,F=Math.atan2(R.sinA,R.cosA)*p+180;E=E.toFixed(2)+"&deg;",F=F.toFixed(2)+"&deg;";for(var G=moonIlluminated(r.ra,r.dec,c.raTopo,c.decTopo,i,n,C,d),N=G.illuminated.toFixed(2),q=G.phase,U=G.elongTxt,B=G.mag.toFixed(1),O=s-e.hours/876600,j=[],H=[],W=0;W<25;W++)a=MediumMoon(O+W/876600),j[W]=a.ra,H[W]=a.dec;var J=getTransitTime(e.LST0,e.lat,j,H,!0),V=J.t+" ("+J.alt+")",Y=getRiseSet(.002327105669325773,e.LST0,e.lat,j,H),X=Y.rise+" ("+Y.azRise+")",K=Y.set+" ("+Y.azSet+")";"above"==Y.rise&&(X="circumpolar",K="circumpolar");var Q="<table>";Q+='<tr><th colspan="2">Moon</th></tr>',Q+="<tr><td>Geocentric Distance</td><td>"+o.toFixed(0)+" km ("+(o/6371).toFixed(1)+"R<sub>&oplus;</sub>)</td></tr>",Q+="<tr><td>Topocentric Distance</td><td>"+C.toFixed(0)+" km ("+(C/6371).toFixed(1)+"R<sub>&oplus;</sub>)</td></tr>",Q+="<tr><td>Angular Diameter</td> <td>"+(3475/C*10800/Math.PI).toFixed(1)+"'</td></tr>",Q+="<tr><td>Phase</td> <td>"+q+"</td></tr>",Q+="<tr><td>Illuminated</td> <td>"+N+"</td> </tr>",Q+="<tr><td>Apparent Magnitude</td> <td>"+B+"</td> </tr>",Q+="<tr><td>Solar Elongation</td> <td>"+U+"</td> </tr>",Q+="<tr><td>Geocentric Ra, Dec (J2000)</td> <td>"+m+", "+v+"</td></tr>",Q+="<tr><td>Topocentric Ra, Dec (J2000)</td> <td>"+D+", "+k+"</td></tr>","nu"in e?(Q+="<tr><td>App. Topo. Ra, Dec (of date)</td> <td>"+z+", "+A+"</td></tr>",Q+="<tr><td>Apparent Sidereal Time</td> <td>"+convertDM(12*e.LAST/Math.PI,"hm")+"</td></tr>"):Q+="<tr><td>Topocentric Ra, Dec (of date)</td> <td>"+z+", "+A+"</td></tr>",Q+="<tr><td>Constellation</td><td>"+I+"</td></tr>",Q+="<tr><td>Altitude, Azimuth</td> <td>"+E+", "+F+"</td></tr>",Q+="<tr><td>Rise (Azimuth)</td> <td>"+X+"</td></tr>",Q+="<tr><td>Upper Transit (Altitude)</td> <td>"+V+"</td></tr>",Q+="<tr><td>Set (Azimuth)</td> <td>"+K+"</td></tr>";var Z="#tip"+e.loc+"text";$(Z).append(Q)}function displayPopupPlanet(t,e){var a=[!1,!1,!0,!1,!1,!1,!1,!1],r=t.pIndex-1;t.pIndex<4&&r--,a[r]=!0;var o,n,i=e.T+e.dT;if(highPrecCalInTips)n={rGeo:(o=planetGeoVSOP(i,t.object,!0)).dSunEarth,lam2000:o.lamSun2000,bet2000:o.betSun2000};else{var d=planetPos(i,a);o=d[r],n=d[2]}var s,l,c=o.rHelio,p=o.rGeo,h=180/Math.PI,g=12/Math.PI,u=convertDM(o.ra2000*g,"hm"),m=convertDM(o.dec2000*h,"dm"),v=Math.cos(e.lat),y=Math.sin(e.lat),M=e.LST;"nu"in e?(M=e.LAST,s=precessed_ra_dec(o.ra,o.dec,e.nu),o.ra=s.ra,o.dec=s.dec,l=topoCentricEquatorial(149597870.7*p,o.ra,o.dec,M,y,v)):l=topoCentricEquatorial(149597870.7*p,o.ra,o.dec,M,y,v);var f={ra:l.raTopo,dec:l.decTopo};if("nu"in e){var S={T:i,m:e.nu,LAST:e.LAST,cosLat:v,sinLat:y};f=aberration(l.raTopo,l.decTopo,S)}var T=convertDM(f.ra*g,"hm"),b=convertDM(f.dec*h,"dm"),x=precession_matrix(i,-i);if("nu"in e){var L={p11:e.nu.p11,p12:e.nu.p21,p13:e.nu.p31,p21:e.nu.p12,p22:e.nu.p22,p23:e.nu.p32,p31:e.nu.p13,p32:e.nu.p23,p33:e.nu.p33};s=precessed_ra_dec(l.raTopo,l.decTopo,L),s=precessed_ra_dec(s.ra,s.dec,x)}else s=precessed_ra_dec(l.raTopo,l.decTopo,x);var P=constellationAbbrNames()[get_constellation(s.ra,s.dec)],z=convertDM(s.ra*g,"hm"),A=convertDM(s.dec*h,"dm"),C=elongationPhase(o,n),_=C.elongation,w=C.illuminated,I={object:t.object,i:C.phaseAng,rHelio:c,rGeo:p,T:i,planet:o,sun:n},D=planetMag(I),k={Mercury:6.726865375887558,Venus:16.68838398040351,Mars:9.3468517633725,Jupiter:192.78588394427936,Saturn:160.5799887548923,Uranus:69.93800100978119,Neptune:67.89738430970871}[t.object]/p,R=ra_dec_to_alt_az(s={ra:f.ra,dec:f.dec},M,v,y),E=(R.alt+atmosphericRefraction(R.alt,101,286))*h,F=Math.atan2(R.sinA,R.cosA)*h+180;E=E.toFixed(2)+"&deg;",F=F.toFixed(2)+"&deg;";var G=[],N=[],q=i-e.hours/876600;a[2]=!1;for(var U=0;U<25;U++)o=planetPos(q+U/876600,a)[r],G[U]=o.ra,N[U]=o.dec;var B=getTransitTime(e.LST0,e.lat,G,N,!1),O=B.t+" ("+B.alt+")",j=getRiseSet(-.009890199094634533,e.LST0,e.lat,G,N),H=j.rise+" ("+j.azRise+"), "+j.set;"above"==j.rise&&(H="circumpolar");var W="#tip"+e.loc+"text",J="<table>";J+='<tr><th colspan="2">'+t.object+"</th></tr>",J+="<tr><td>Heliocentric Distance</td> <td>"+c.toFixed(3)+" AU</td></tr>",J+="<tr><td>Geocentric Distance</td> <td>"+p.toFixed(3)+" AU</td></tr>",J+="<tr><td>Angular Diameter</td> <td>"+k.toPrecision(3)+'"</td></tr>',J+="<tr> <td>Elongation</td> <td>"+_+"</td></tr>",t.pIndex<5&&(J+="<tr><td>Illuminated</td> <td>"+w+"</td></tr>"),J+="<tr><td>Apparent Magnitude</td> <td>"+D.toFixed(1)+"</td></tr>",J+="<tr><td>Geocentric Ra, Dec (J2000)</td> <td>"+u+", "+m+"</td></tr>",J+="<tr><td>Topocentric Ra, Dec (J2000)</td> <td>"+z+", "+A+"</td></tr>","nu"in e?(J+="<tr><td>App. Topo. Ra, Dec (of date)</td> <td>"+T+", "+b+"</td></tr>",J+="<tr><td>Apparent Sidereal Time</td> <td>"+convertDM(12*e.LAST/Math.PI,"hm")+"</td></tr>"):J+="<tr><td>Topocentric Ra, Dec (of date)</td> <td>"+T+", "+b+"</td></tr>",J+="<tr><td>Constellation</td><td>"+P+"</td></tr>",J+="<tr><td>Altitude, Azimuth</td> <td>"+E+", "+F+"</td></tr>",J+="<tr><td>Rise (Azi), Set</td> <td>"+H+"</td></tr>",J+="<tr><td>Upper Transit (Altitude)</td> <td>"+O+"</td></tr>",$(W).append(J)}function displayPopupStar(t,e){var a=brightStars(),r=a[t.starInd],o=e.T+e.dT,n=a[0].Tepoch,i=o-n,d=r.x+r.vx*i,s=r.y+r.vy*i,l=r.z+r.vz*i,c=Math.sqrt(d*d+s*s+l*l);if(o>-50&&o<10){var p=planetPos(o,[!1,!1,!0,!1,!1,!1,!1,!1])[2],h=p.rGeo*Math.PI/648e3;d-=-h*Math.cos(p.ra2000)*Math.cos(p.dec2000),s-=-h*Math.sin(p.ra2000)*Math.cos(p.dec2000),l-=-h*Math.sin(p.dec2000),c=Math.sqrt(d*d+s*s+l*l)}var g=180/Math.PI,u=12/Math.PI,m=Math.atan2(s,d),v=Math.asin(l/c),y=convertDM(m*u,"hm"),M=convertDM(v*g,"dm"),f=constellationAbbrNames(),S=f[get_constellation(m,v)],T=f[r.con];S!=T&&(S=T+" (2000), "+S+" (",S+=(1==e.loc?date1.yyyy:date2.yyyy)+")");var b=precession_matrix(n,i),x=e.LST;"nu"in e&&(x=e.LAST,b={p11:e.nu.p11*b.p11+e.nu.p12*b.p21+e.nu.p13*b.p31,p12:e.nu.p11*b.p12+e.nu.p12*b.p22+e.nu.p13*b.p32,p13:e.nu.p11*b.p13+e.nu.p12*b.p23+e.nu.p13*b.p33,p21:e.nu.p21*b.p11+e.nu.p22*b.p21+e.nu.p23*b.p31,p22:e.nu.p21*b.p12+e.nu.p22*b.p22+e.nu.p23*b.p32,p23:e.nu.p21*b.p13+e.nu.p22*b.p23+e.nu.p23*b.p33,p31:e.nu.p31*b.p11+e.nu.p32*b.p21+e.nu.p33*b.p31,p32:e.nu.p31*b.p12+e.nu.p32*b.p22+e.nu.p33*b.p32,p33:e.nu.p31*b.p13+e.nu.p32*b.p23+e.nu.p33*b.p33});var L=b.p11*d+b.p12*s+b.p13*l,P=b.p21*d+b.p22*s+b.p23*l,z=b.p31*d+b.p32*s+b.p33*l,A=Math.atan2(P,L),C=Math.asin(z/c);if("nu"in e){var _={T:o,m:e.nu,LAST:e.LAST,cosLat:Math.cos(e.lat),sinLat:Math.sin(e.lat)};A=(j=aberration(A,C,_)).ra,C=j.dec}var w,I=convertDM(A*u,"hm"),D=convertDM(C*g,"dm"),k="<table>",R=r.name,E=3.2616*c,F="";w=r.dist2000>=99e3?"?":c.toPrecision(4)+" pc ("+E.toPrecision(4)+" ly)","bayer"in r&&"<"!=R.slice(0,1)&&(R+=", "+r.bayer+" "+r.con);var G=r.mag.toFixed(2),N="Mag.",q=0;if(r.dist2000<99e3){var U=r.mag+5-5*Math.LOG10E*Math.log(r.dist2000);q=5*Math.LOG10E*Math.log(c/r.dist2000),N+=", Abs. Mag.",G=(G=r.mag+q).toFixed(2)+", "+U.toFixed(2)}if("varMax"in r&&"varMin"in r){var B=parseFloat(r.varMax)+q,O=parseFloat(r.varMin)+q;F=B.toFixed(2)+" &ndash; "+O.toFixed(2)}k+='<tr><th colspan="2">'+R+"</th></tr>",k+="<tr><td>"+N+"</td> <td>"+G+"</td></tr>",""!=F&&(k+="<tr><td>Variable</td> <td>"+F+"</td></tr>"),k+="<tr><td>Distance</td> <td>"+w+"</td></tr>","spect"in r&&(k+="<tr><td>Spec, col. ind.</td> <td>"+r.spect,"colorInd"in r&&(k+=", "+r.colorInd),k+="</td></tr>"),k+="<tr><td>Constellation</td> <td>"+S+"</td></tr>",k+="<tr><td>Ra, Dec (J2000)</td> <td>"+y+", "+M+"</td></tr>","nu"in e?(k+="<tr><td>App. Ra, Dec (of date)</td> <td>"+I+", "+D+"</td></tr>",k+="<tr><td>Apparent Sidereal Time</td> <td>"+convertDM(12*e.LAST/Math.PI,"hm")+"</td></tr>"):k+="<tr><td>Ra, Dec (of date)</td> <td>"+I+", "+D+"</td></tr>";var j={ra:A,dec:C},H=ra_dec_to_alt_az(j,x,Math.cos(e.lat),Math.sin(e.lat)),W=(H.alt+atmosphericRefraction(H.alt,101,286))*g,J=Math.atan2(H.sinA,H.cosA)*g+180;k+="<tr><td>Alt, Azimuth</td> <td>"+W.toFixed(2)+"&deg;, "+J.toFixed(2)+"&deg;</td></tr>",W=-.009890199094634533;var V=riseSetStar(e.LST0,W,e.lat,A,C);k+="<tr><td>Upper Transit (Alt)</td> <td>"+(V.transit+" ("+V.altTransit+")")+"</td></tr>";var Y=V.rise+" ("+V.azRise+"), "+V.set;"above"==V.rise&&(Y="circumpolar"),k+="<tr><td>Rise (Azi), Set</td> <td>"+Y+"</td></tr>",k+="</table>";var X="#tip"+e.loc+"text";$(X).append(k)}function setupDrawingParameters(){var t=-4/6.5;return{color:["red","orange","maroon","#FF00FF","red","brown","brown","#7277e6","#7277e6"],code:[9788,9789,9791,9792,9794,9795,9796,9954,9798],size:[1,2,1,2,2,2,2,2,2],offset:[{x:-10,y:7},{x:-10,y:7},{x:-5,y:7},{x:-7,y:0},{x:-7,y:2},{x:-10,y:7},{x:-5,y:7},{x:-10,y:3},{x:-8,y:5}],pName:["Sun","Moon","Mercury","Venus","Mars","Jupiter","Saturn","Uranus","Neptune"],starMagA:t,starMagB:4.076923076923077}}milkyLoc[0]={northernEdge:northernEdge(),southernEdge:southernEdge(),betaCas:betaCas(),thetaOph:thetaOph(),lambdaSco:lambdaSco(),coalsack:coalsack()},milkyLoc[1]={northernEdge:northernEdge(),southernEdge:southernEdge(),betaCas:betaCas(),thetaOph:thetaOph(),lambdaSco:lambdaSco(),coalsack:coalsack()};